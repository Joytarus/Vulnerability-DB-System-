<template>
    <div class="search-results-page">
      <h1>Search Results for "{{ $route.query.search }}"</h1>
      <div v-if="!hasResults">
        <p>No results found.</p>
      </div>
      <div v-else>
        <section v-if="results.blogs.length">
          <h2>Blog Posts</h2>
          <ul>
            <li v-for="blog in results.blogs" :key="blog.id">
              <router-link :to="'/blogs/'">{{ blog.title }}</router-link>
            </li>
          </ul>
        </section>
        <section v-if="results.resources.length">
          <h2>Educational Resources</h2>
          <ul>
            <li v-for="resource in results.resources" :key="resource.id">
              <router-link :to="'/resources/'">{{ resource.title }}</router-link>
            </li>
          </ul>
        </section>
        <section v-if="results.vulnerabilities.length">
            <h2>Vulnerabilities</h2>
            <ul>
                <li v-for="vulnerability in results.vulnerabilities" :key="vulnerability.id">
                <router-link v-if="vulnerability.cve && vulnerability.cve.descriptions && vulnerability.cve.descriptions.length > 0" :to="'/vulnerability/' + vulnerability.cve.id">
                    {{ vulnerability.cve.id }} - {{ vulnerability.cve.descriptions[0].value }}
                </router-link>
                <p v-else>No CVE description available.</p>
                </li>
            </ul>
        </section>

      </div>
    </div>
  </template>
  
  <script>
  import axios from 'axios';
  import { ref, onMounted, watch } from 'vue';
  import { useRoute } from 'vue-router';
  
  export default {
    setup() {
      const route = useRoute();
      const results = ref({ blogs: [], resources: [], vulnerabilities: [] });
      const hasResults = ref(false);
  
      const fetchSearchResults = async (searchTerm) => {
        try {
          const searchURL = `http://localhost:3000/search?q=${encodeURIComponent(searchTerm)}`;
          const response = await axios.get(searchURL);
          results.value = response.data;
          hasResults.value = 
            results.value.blogs.length > 0 ||
            results.value.resources.length > 0 ||
            results.value.vulnerabilities.length > 0;
        } catch (error) {
          console.error("Error fetching search results:", error);
        }
      };
  
      onMounted(() => {
        if (route.query.search) {
          fetchSearchResults(route.query.search);
        }
      });
  
      watch(() => route.query.search, (newSearchTerm) => {
        fetchSearchResults(newSearchTerm);
      });
  
      return {
        results,
        hasResults
      };
    }
  };
  </script>
  
  <style scoped>
.search-results-page {
  padding: 1rem;
  max-width: 1000px;
  margin: 0 auto;
}

h1 {
  color: #333;
  text-align: center;
  margin-bottom: 2rem;
}

h2 {
  color: #555;
  margin-top: 2rem;
  border-bottom: 2px solid #eee;
  padding-bottom: 0.5rem;
}

ul {
  list-style: none;
  padding: 0;
  margin: 0;
}

li {
  margin-bottom: 1rem;
  background-color: #f9f9f9;
  padding: 1rem;
  border-radius: 5px;
  transition: background-color 0.3s ease;
}

li:hover {
  background-color: #e9e9e9;
}

.router-link-active {
  color: #42b983;
}

a {
  text-decoration: none;
  color: #666;
  font-weight: bold;
}

a:hover {
  text-decoration: underline;
}

@media (min-width: 768px) {
  .search-results-page {
    padding: 2rem;
  }

  h2 {
    margin-top: 3rem;
  }

  ul {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 1rem;
  }
}

@media (max-width: 480px) {
  .search-results-page {
    padding: 1rem;
  }

  h1 {
    font-size: 1.5rem;
  }
}
</style>
  